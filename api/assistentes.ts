\nimport type { VercelRequest, VercelResponse } from \'@vercel/node\';\nimport { getSheetsClient, SPREADSHEET_ID, ensureSheetExists } from \'./utils/googleSheetsClient.js\';\nimport { AssistenteModel } from \'../src/paginas/Crm/modelos/AssistenteModel\';\n\nconst SHEET_NAME = \'Assistentes\';\nconst HEADERS = [\'id\', \'nome\', \'prompt\', \'avatar\', \'webhook\', \'origem\'];\nconst RANGE = `${SHEET_NAME}!A:F`;\n\n// Função para adicionar um assistente à planilha\nconst addAssistente = async (assistenteData: Omit<AssistenteModel, \'id\>): Promise<AssistenteModel> => {\n    const sheets = await getSheetsClient();\n    const novoAssistente: AssistenteModel = {\n        id: Date.now().toString(),\n        ...assistenteData\n    };\n\n    await sheets.spreadsheets.values.append({\n        spreadsheetId: SPREADSHEET_ID,\n        range: RANGE,\n        valueInputOption: \'USER_ENTERED\',\n        requestBody: {\n            values: [[\n                novoAssistente.id,\n                novoAssistente.nome,\n                novoAssistente.prompt,\n                novoAssistente.avatar || \'\',\n                novoAssistente.webhook || \'\',\n                novoAssistente.origem || \'\'\n            ]]\n        }\n    });\n\n    return novoAssistente;\n};\n\n// Handler da Vercel Serverless Function\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\n    try {\n        const sheets = await getSheetsClient();\n        // Garante que a planilha \'Assistentes\' exista com os cabeçalhos corretos\n        await ensureSheetExists(sheets, SPREADSHEET_ID!, SHEET_NAME, HEADERS);\n\n        if (req.method === \'POST\') {\n            const novoAssistente = await addAssistente(req.body);\n            res.status(201).json(novoAssistente);\n        } else {\n            res.setHeader(\'Allow\', [\'POST\']);\n            res.status(405).end(`Método ${req.method} não permitido.`);\n        }\n    } catch (error) {\n        console.error(\"Erro na API de Assistentes:\", error);\n        const message = error instanceof Error ? error.message : \'Um erro interno ocorreu.\';\n        res.status(500).json({ error: \'Falha ao processar a requisição.\', details: message });\n    }\n}\n